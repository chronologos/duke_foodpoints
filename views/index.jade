doctype
html(lang='en')
  head
    title FoodPoints+
    meta(charset='utf-8')
    meta(name="viewport", content="width=device-width, initial-scale=1")
    
    script(src="//code.jquery.com/jquery-2.1.1.js")
    script(src='//cdn.datatables.net/1.10.3/js/jquery.dataTables.min.js')
    script(src='//cdn.datatables.net/plug-ins/380cb78f450/integration/bootstrap/3/dataTables.bootstrap.js')
    script(src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js")
    script(src='//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.2/moment.min.js')
    script(src='//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js')
    script(src='//cdnjs.cloudflare.com/ajax/libs/c3/0.3.0/c3.js') 
    script(src='//cdn.jsdelivr.net/cal-heatmap/3.4.0/cal-heatmap.js')
    script(src='ga.js')
    script(src="countdown.js")
    script(src='utility.js')
    script(src='chart.js')
    script(src='cal-heatmap.js')

    link(href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/superhero/bootstrap.min.css", rel="stylesheet")
    //link(href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css", rel="stylesheet")
    link(href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css", rel="stylesheet")
    link(rel="stylesheet", href='//cdn.jsdelivr.net/cal-heatmap/3.4.0/cal-heatmap.css')
    link(rel='stylesheet', href='//cdnjs.cloudflare.com/ajax/libs/c3/0.3.0/c3.css')
    link(rel='stylesheet', href='//cdn.datatables.net/plug-ins/380cb78f450/integration/bootstrap/3/dataTables.bootstrap.css')

    script.
      var user =!{JSON.stringify(user)}
      console.log(user)
    style.
      .c3-tooltip { color:#000; }
      .pic {width:100px; float:right;}
      .progress{height:30px;}
  body
    .container
      h1 FoodPoints+
      div
        if (user)
          a.btn.btn-default(href="/logout") Sign Out
          a.btn.btn-primary(href=auth_link) Link DukeCard
        else
          a.btn.btn-default(href="/auth/google") Sign In with Google
        a.btn.btn-info(href="https://dco3.auxserv.duke.edu/onlineoffice", target="_blank") DukeCard Office
        a.btn.btn-success(href="/whatsopen") What's Open?
      hr
      if user
        img.pic(src=user.picture, alt=user.name)
        h3 Welcome back, #{user.given_name}!
        if (user.refresh_token)
          p Congratulations!  FoodPoints+ is now tracking your balances.
          p Your DukeCard link expires: 
            span.format #{user.refresh_token_expire}
        else
          p Link your DukeCard to start tracking your balances.
      .row
        .col-md-6
          h3 Countdown
          p You started at:
          input.form-control#plan(type="text")
          p You should have:
          div.progress
            div#progbar.progress-bar.progress-bar-default.progress-bar-striped.active
              div.lead#result
          if user
            p You currently have:
            div.lead=user.balances[0].balance
        if user    
           .col-md-6
             h3 Transactions
             table.table#transactions
               thead
                 tr
                   th Date
                   th Amount
                each b in user.exps
                  tr
                    td.format=b.date
                    td=b.amount.toFixed(2)
      if user
        .row
           .col-md-6
             h3 Chart
             div#chart
           .col-md-6
             h3 Breakdown
             div#pie
           .col-md-6
             h3 Days
             div#days
           .col-md-6
             h3 Hours
             div#hours
           .col-md-12
             h3 Budgets
             p Send me email when I spend more than X in the last X